<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User Manager untuk POSPLUS</title>
    <style>
        body { font-family: sans-serif; max-width: 600px; margin: 20px auto; padding: 0 20px; background: #f5f5f5; }
        .container { background: white; border-radius: 15px; padding: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
        h2 { color: #006B54; margin-top: 0; }
        .form-group { margin-bottom: 15px; }
        label { display: block; font-weight: 600; margin-bottom: 5px; color: #333; }
        input, select { width: 100%; padding: 10px; border: 1px solid #333; border-radius: 10px; font-size: 1rem; }
        button { background: #006B54; color: white; border: none; border-radius: 10px; padding: 12px 20px; font-weight: 600; cursor: pointer; margin-right: 10px; }
        button.secondary { background: #d9d9d9; color: #333; }
        .user-list { margin-top: 20px; border-top: 1px solid #ddd; padding-top: 20px; }
        .user-item { display: flex; justify-content: space-between; align-items: center; background: #f9f9f9; border-radius: 10px; padding: 10px; margin-bottom: 10px; }
        .user-item .info { flex: 1; }
        .user-item button { padding: 6px 12px; font-size: 0.9rem; }
        .export-btn { width: 100%; margin-top: 20px; }
        .notification { position: fixed; top: 20px; left: 50%; transform: translateX(-50%); background: #006B54; color: white; padding: 12px 20px; border-radius: 10px; display: none; }
    </style>
</head>
<body>
    <div class="container">
        <h2>User Manager untuk POSPLUS</h2>
        <p>Buat akun pengguna (admin/kasir) yang akan diekspor ke file JSON. File ini kemudian di-import ke aplikasi POSPLUS melalui tombol "Import Data" di layar login.</p>
        
        <div class="form-group">
            <label>Username</label>
            <input type="text" id="username" placeholder="username">
        </div>
        <div class="form-group">
            <label>Password</label>
            <input type="password" id="password" placeholder="password">
        </div>
        <div class="form-group">
            <label>Nama Lengkap</label>
            <input type="text" id="fullname" placeholder="Nama">
        </div>
        <div class="form-group">
            <label>Role</label>
            <select id="role">
                <option value="admin">Admin</option>
                <option value="kasir">Kasir</option>
            </select>
        </div>
        <button onclick="addUser()">Tambah User</button>
        <button class="secondary" onclick="clearList()">Hapus Semua</button>

        <div class="user-list" id="userList"></div>

        <button class="export-btn" onclick="exportUsers()">ðŸ“¥ Ekspor ke File JSON</button>
    </div>

    <div id="notification" class="notification"></div>

    <script>
        let users = [];

        // Fungsi hash password (sama dengan di POSPLUS)
        async function hashPassword(password) {
            if (window.crypto && window.crypto.subtle) {
                try {
                    const encoder = new TextEncoder();
                    const data = encoder.encode(password);
                    const hashBuffer = await crypto.subtle.digest('SHA-256', data);
                    const hashArray = Array.from(new Uint8Array(hashBuffer));
                    return hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
                } catch (e) {
                    console.warn('Crypto digest failed, using fallback', e);
                }
            }
            // Fallback sederhana (jika crypto tidak tersedia)
            let hash = 0;
            for (let i = 0; i < password.length; i++) {
                const char = password.charCodeAt(i);
                hash = ((hash << 5) - hash) + char;
                hash |= 0;
            }
            return hash.toString(16);
        }

        // Notifikasi
        function showNotification(msg, type = 'success') {
            const notif = document.getElementById('notification');
            notif.textContent = msg;
            notif.style.backgroundColor = type === 'success' ? '#006B54' : '#dc3545';
            notif.style.display = 'block';
            setTimeout(() => { notif.style.display = 'none'; }, 2000);
        }

        // Render daftar user
        function renderUserList() {
            const listDiv = document.getElementById('userList');
            if (users.length === 0) {
                listDiv.innerHTML = '<p style="color:#666;">Belum ada user.</p>';
                return;
            }
            let html = '';
            users.forEach((user, index) => {
                html += `
                    <div class="user-item">
                        <div class="info">
                            <strong>${user.name}</strong> (${user.username}) - ${user.role}
                        </div>
                        <button onclick="removeUser(${index})">Hapus</button>
                    </div>
                `;
            });
            listDiv.innerHTML = html;
        }

        // Tambah user baru
        async function addUser() {
            const username = document.getElementById('username').value.trim();
            const password = document.getElementById('password').value.trim();
            const name = document.getElementById('fullname').value.trim();
            const role = document.getElementById('role').value;

            if (!username || !password || !name) {
                showNotification('Semua field harus diisi', 'error');
                return;
            }

            // Cek duplikat username
            if (users.some(u => u.username === username)) {
                showNotification('Username sudah ada', 'error');
                return;
            }

            const hashed = await hashPassword(password);
            const now = new Date().toISOString();

            users.push({
                // id tidak disertakan, biarkan database yang menggenerate
                username,
                password: hashed,
                role,
                name,
                createdAt: now,
                updatedAt: now
            });

            // Reset form
            document.getElementById('username').value = '';
            document.getElementById('password').value = '';
            document.getElementById('fullname').value = '';
            document.getElementById('role').value = 'admin';

            renderUserList();
            showNotification('User ditambahkan');
        }

        // Hapus user
        function removeUser(index) {
            users.splice(index, 1);
            renderUserList();
            showNotification('User dihapus');
        }

        // Hapus semua
        function clearList() {
            if (users.length === 0) return;
            if (confirm('Hapus semua user?')) {
                users = [];
                renderUserList();
            }
        }

        // Ekspor ke file JSON
        function exportUsers() {
            if (users.length === 0) {
                showNotification('Tidak ada user untuk diekspor', 'error');
                return;
            }

            const exportData = {
                users: users
                // Bisa juga menambahkan properti lain jika diperlukan, tapi POSPLUS hanya akan membaca users
            };

            const dataStr = JSON.stringify(exportData, null, 2);
            const blob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `users_backup_${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
            showNotification('File berhasil diunduh');
        }
    </script>
</body>
</html>
